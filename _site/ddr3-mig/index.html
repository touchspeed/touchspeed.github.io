<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Meve's blog" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Meve's blog" /> <title> Xilinx FPGA ddr3 MIG 控制器 - Meve's blog </title> <link rel="alternate" href="http://localhost:4000/ddr3-mig/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/ddr3-mig/" /> <meta name="description" content="Hello World" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Xilinx FPGA ddr3 MIG 控制器 | Meve" /> <meta property="og:title" content="Xilinx FPGA ddr3 MIG 控制器 | Meve" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/ddr3-mig/" /> <meta property="og:description" content="Hello World" /> <meta property="og:image" content="http://localhost:4000/assets/img/ogp.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Xilinx FPGA ddr3 MIG 控制器 | " /> <meta name="twitter:url" content="http://localhost:4000/ddr3-mig/" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:description" content="Hello World" /> <meta name="twitter:image" content="http://localhost:4000/assets/img/ogp.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Meve&apos;s blog" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#ip">IP</a>, <a class="tag" href="/tags/#fpga">FPGA</a> </span> </div> <h1 class="header-title" itemprop="headline">Xilinx FPGA ddr3 MIG 控制器</h1> <div class="post-meta"> <time datetime="2024-07-02T15:03:00+07:00" itemprop="datePublished"> Jul 02, 2024 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Meve</span> </span> <time hidden datetime="" itemprop="dateModified"> Jul 02, 2024 </time> <span hidden itemprop="publisher" itemtype="Person">Meve</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><h2 id="fpga-ddr3控制器">FPGA DDR3控制器</h2> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <h2 id="fpga-ddr3控制器"> <a href="#fpga-ddr3控制器" class="anchor-head"></a> FPGA DDR3控制器 </h2> <h2 id="前言"> <a href="#前言" class="anchor-head"></a> 前言 </h2> <p>由于DDR3速度高、吞吐量大、双边沿、命令复杂、从命令到数据延时时间长以及刷新、预充电等诸多内容，因此DDR3使用比较复杂。 鉴于此，在当前的FPGA与DDR3的应用中将DDR3物理层读写（DDR3控制器）与应用层分开，使得物理层控制器有专门的人或单位（如Xilinx，Intel等）维护，用户只关心应用层与控制器之间的读写，而不需要直接与底层的DDR3信号打交道，这样就简化了用户使用DDR3的难度，如图 <img src="image.png" alt="alt text" /></p> <p>从上图，可以看出FPGA DDR CONTROLLER起到隔离APP与DDR3接口的作用，同时又是FPGA APP与DDR3沟通的桥梁。从APP的角度看，APP 利用 Control、Address、data等总线所访问的就是DDR3本身，而并不知道DDR控制器的存在，所以DDR控制器起到了翻译、解释和桥梁的作用，如图所示 <img src="image-1.png" alt="alt text" /></p> <p>首先建立一个空的工程</p> <p><img src="image-2.png" alt="alt text" /></p> <p>打开IP catalog 窗口 ，双击IP Catalog <img src="image-3.png" alt="alt text" /></p> <p>选择DDR控制器IPcore 在IP Catalog 对话框中找到 Memories&amp; Storage Elements–&gt;Memory Interface Generator–&gt;Memory Interface Generator(MIG 7 Series) <img src="image-4.png" alt="alt text" /></p> <p>点击 Next，在新界面中对MIG（Memory Interface Generator)及项目中使用的器件（FPGA），软件工具，开发语言（Verilog）进行了描述，如图所示。 点击Next <img src="image-5.png" alt="alt text" /></p> <p>MIG（Memory Interface Generator) 新界面如图 <img src="image-6.png" alt="alt text" /></p> <p>选项意思如下：</p> <p>MIG Output Option</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Create Design
    该选项包含生成RTL，XDC， implementation 及simulation文件，可以用来仿真测试，也可以作为整个工程的一个部件。其中XDC仅仅针对DDR控制器的约束文件。

Verify Pin Changes and Update Design
    该选项针对以前已经生成的DDR控制器，由于管脚的更改等因素需要重新验证。该选项也会重新生成新的DDR控制器。
</code></pre></div></div> <hr /> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Component Name 
    DDR控制器组件的名称，将mig_7 series_0修改成DDR3_INTF，将在工程目录内创建DDR_INT的子目录，并在该目录下生成”example_design”,”user_design”与”docs”等目录及文件。

    user_design文件包含了生成的DDR控制器的接口。该接口包含两个部分，（1）与DDR3 芯片的接口（2）控制器与APP的接口。如图1所示。
    example_design 除了包含接口外还添加了一个简单的应用案例，可用来学习或模仿如何使用新生成的控制器。
    docs 包含了控制器的说明文档。
</code></pre></div></div><hr /> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Multi-Controller
    可以选择一个也可以选择多个（最多可以8个），根据硬件电路决定。本例选择一个。
</code></pre></div></div><hr /> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AXI4 Interface
    AXI接口,如果熟悉AXI接口或与该控制器对接的部件使用AXI接口，则选择AXI接口。如果不选AXI则使用传统的控制接口。本例测试不采用AXI接口，因此不选AXI接口。后续有专门的文章介绍AXI总线的使用。
</code></pre></div></div> <p>下一步</p> <p>管脚兼容性FPGA器件选择</p> <p>DDR控制器生成器向导可以根据工程选择的器件推断出在同样封装的器件家族中还有哪些器件可以与工程中使用的器件管脚兼容，如果选择兼容的器件，将来该控制器可在其它兼容器件上使用，如图所示。点击Next.</p> <p><img src="image-7.png" alt="alt text" /></p> <p>下一步</p> <p>DDR 器件选择 如图，xc7a100tfgg676-2器件支持DDR3，DDR2以及LPDDR2。本例选择DDR3 SDRAM。 <img src="image-8.png" alt="alt text" /> DDR3L 与LPDDR3器件虽然不能被ARTIX系列器件支持，但其它7系列器件可以支持，如Kintex 系列FPGA器件。 DDR3L :低电压系列，接口电压1.35V。 LPDDR3:是一种用在移动设备上的功耗更低，体积更小的器件，电压1.2V。</p> <p>下一步</p> <p><img src="image-9.png" alt="alt text" /></p> <p>Clock Period 输入时钟周改为2500PS（400MHz），对于ARTIX系列最高可以为400HZ，但是向下兼容。</p> <p>控制器与PHY（物理层）的时钟比例4：1，是指FPGA提供给DDR3的时钟频率与控制器时钟频率的比率。这个比率只能选择4：1或2：1。这个选择对于控制器与APP接口数据宽度有很大的关系，如图2，图3所示。3000</p> <p>VCCAUX的电压设为1.8V，对于Kintex系列，如果FPGA使用HP BANK（如BANK32，BANK33等），VCCAUX设为2.0V 可以提高控制器的读写性能，如可以设置CK时钟为800M或更高。</p> <p>Memory的类型选择DDR3芯片（ Components）或内存条RDIMMS，LRDIMMS，UDIMMS，SODIMMS等。这里选择芯片（component）。并在下拉框中选择合适的器件，如果找不到对应的器件，则需要创建一个新器件。</p> <p>DDR3电压1.5V，如果使用DDR2应为1.8V。</p> <p>ECC （disable），只有72数据口线宽度才支持ECC，其中数据64位，ECC为8位。</p> <p>Data Mask, 是否产生DDR3 DM 控制脚。如果不用DM，可以节省FPGA的管脚。</p> <p>BANK Mechine数量， 选择 -4或选择-8等，选择范围2–8。数量越大，耗费FPGA资源越多，但效率越高。主要的原因是在连续读写时，在对一个DDR3 bank读写时可以同时打开其它的DDR3 bank，可以节省由于BANK切换时的预充电（Precharge ）及激活（Activating)时间。</p> <p>ORDERING 命令执行顺序 有Normal和Strict 两种。Strick严格按照给定的顺序执行。Normal模式下，DDR控制器可以重新调整执行顺序以达到更高的读写效率。</p> <p><img src="image-10.png" alt="alt text" /> <img src="image-11.png" alt="alt text" /></p> <p><img src="image-12.png" alt="alt text" /></p> <p>DDR控制器其它参数设置</p> <p>输入频率，设置合适的输入频率，这里使用100MHz.</p> <p>突发类型（Burst Type）:选择Sequential</p> <p>输出强度（ODI）:可以选择RZQ/6 （40欧姆）或RZQ/7（34欧姆）。</p> <p>片选（CS#）: 在多个RANK时使用CS#，选择Enable。单个RANK时可以选择Disable,可以节省FPGA管脚。</p> <p>RTT（ODT）,选择RZQ/4（60欧姆）或RZQ/6（40欧姆）。</p> <p>地址映射顺序，选择ROW+BANK+COLLUM</p> <p><img src="image-13.png" alt="alt text" /></p> <p>点击Next</p> <p><img src="image-14.png" alt="alt text" /></p> <p>如图设置如下：</p> <p>System Clock: DDR 控制器输入时钟设置，可以外接到FPGA管脚的输入时钟，此时可以选择差分（Differential ）, 单端（Single End）。如果选择FPGA内部PLL的输出作为DDR控制器的输入管脚，此时应该选择No Buffer，因为PLL的输出已经有全局时钟驱动。</p> <p>参考时钟（Reference Clock），该时钟主要用来调整与DDR相连的FPGA管脚的输入模块延时的矫正，一般为200MHz，细节可以参考FPGA输入延时相关的文章。由于参考时钟也是 来自FPGA内部PLL，因此选择No Buffer。</p> <p>复位脚极性，根据DDR3资料，DDR3的复位脚低电平有效，因此选择Active Low。</p> <p>调试选项，这里选择OFF。</p> <p>内部参考电压（Internal Ref），这个选项是指FPGA对应BANK参考电压选项，可以使用内部的参考电压生成器，也可以使用外部参考电压。当DDR时钟超过400MHz，一定要选择外部提供的参考时钟，以降低参考时钟的噪声。本例恰好400Mhz，因此选择内部参考时钟。</p> <p>O功耗降低，选择该项为“ON”可以IO的功耗。就是在非读期间关闭DQ/DQS的输入Buffer，以及FPGA端的终端匹配电阻（RTT）。</p> <p>XADC, FPGA 内部的ADC，可以使能或非使能。</p> <p>下一步Next</p> <p><img src="image-15.png" alt="alt text" /></p> <p>下一步Next</p> <p>对照硬件连接分配引脚，出现错误</p> <p>ERROR : Address ports can be allocated to non memory byte group pins (not in T0, T1, T2, or T3) if and only if its adjacent byte is non Data byte group (i.e either Address/Control or empty) and it should contain at least one unallocated pin or allocated with memory clock pair. Refer to UG586 and AR# 45588 for more information.</p> <p><img src="image-16.png" alt="alt text" /></p> <p>不确定是不是此开发板DDR3的设计错误</p> <p><img src="image-17.png" alt="alt text" /></p> <p>先采用新设计创建IP，再将IO Ports改为硬件对应连接，Implementation出现Implementation Complete，Failed Nets!</p> <p><img src="image-18.png" alt="alt text" /></p> <p>暂时还没能解决 [07_11_2024]</p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/flame-shot/" > <div class="nav-arrow">Previous</div> <span class="post-title">flameshot，平替snipaste</span> </a> <a class="post-nav-item post-nav-next" href="/work-prjs/"> <div class="nav-arrow">Next</div> <span class="post-title">部分工作内容展示</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="/thanks">ack.</a> <a class="footer_item" href="javascript::void(0)">resume</a> <a class="footer_item" href="/feed.xml">rss</a> <span class="footer_item">&copy; 2024</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
